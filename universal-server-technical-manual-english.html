<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Welcome to the Universal Server documentation</title>
<meta content="Universal Server" name="keywords" />
<link rel="stylesheet" href="pygments-default.css" type="text/css" />
<link rel="stylesheet" href="us-main.css" type="text/css" />
<link href="us-main-icon.png" rel="icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="document" id="technical-manual-of-the-universal-server">
<h1 class="title">Technical Manual of the <tt class="docutils literal">Universal Server</tt></h1>

<span class="target" id="top"></span><p><span class="raw-html"><a name="universal-server_top"></a></span></p>
<p><span class="raw-html"><div class="banner"><p><em>Universal Server documentation</em> <a href="http://us-main.esperide.org">browse latest</a> <a href="https://olivier-boudeville.github.io/us-main/index.html">browse mirror</a> <a href="universal-server-technical-manual-english.pdf">get PDF</a> <a href="#universal-server_top">go to top</a> <a href="#us-main_toc">go to toc</a> <a href="#universal-server_bottom">go to bottom</a> <a href="api-doc/index.html">browse API</a> <a href="https://github.com/Olivier-Boudeville/us-main">go to project</a><a href="mailto:about(dash)universal-server(at)esperide(dot)com?subject=[Universal%20Server]%20Remark">email us</a></p></div></span></p>
<p><span class="raw-html"><center><img src="us-main-title.png" id="responsive-image-medium"></img></span>
</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Organisation:</th><td class="field-body"><p class="first">Copyright (C) 2019-2022 Olivier Boudeville</p>
</td>
</tr>
<tr class="field"><th class="field-name">Contact:</th><td class="field-body"><p class="first">about (dash) universal-server (at) esperide (dot) com</p>
</td>
</tr>
<tr class="field"><th class="field-name">Creation date:</th><td class="field-body"><p class="first">Saturday, May 2, 2020</p>
</td>
</tr>
<tr class="field"><th class="field-name">Lastly updated:</th><td class="field-body"><p class="first">Wednesday, January 5, 2022</p>
</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body"><p class="first">0.0.5</p>
</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body"><p class="first">In progress</p>
</td>
</tr>
<tr class="field"><th class="field-name">Dedication:</th><td class="field-body"><p class="first">Users and maintainers of the <tt class="docutils literal">Universal Server</tt>.</p>
</td>
</tr>
<tr class="field"><th class="field-name">Abstract:</th><td class="field-body"><p class="first">The <a class="reference external" href="http://us-main.esperide.org/">Universal Server</a>, part of the umbrella project <a class="reference external" href="https://github.com/Olivier-Boudeville/Universal-Server">of the same name</a>, is a multi-service daemon in charge of the automation (monitoring, scheduling and performing) of various computer-based tasks, such as the proper management of the server itself or, in the future, of house automation.</p>
<p class="last">We present here a short overview of these services, to introduce them to newcomers.</p>
</td>
</tr>
</tbody>
</table>
<p><span class="raw-html"></center></span></p>
<p></p>
<p><span class="raw-html"><a name="us-main_toc"></a></span></p>
<div class="contents topic" id="id1">
<span id="table-of-contents"></span><p class="topic-title"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id18">Overview</a></li>
<li><a class="reference internal" href="#layer-stack" id="id19">Layer Stack</a></li>
<li><a class="reference internal" href="#configuration" id="id20">Configuration</a></li>
<li><a class="reference internal" href="#facilities-provided-by-this-us-main-layer" id="id21">Facilities Provided by this US-Main Layer</a><ul>
<li><a class="reference internal" href="#monitoring-of-host-sensors" id="id22">Monitoring of Host Sensors</a><ul>
<li><a class="reference internal" href="#preparing-the-setup" id="id23">Preparing the Setup</a></li>
<li><a class="reference internal" href="#mode-of-operation-of-the-sensor-manager" id="id24">Mode of Operation of the Sensor Manager</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7" id="id25">Contact Directory</a><ul>
<li><a class="reference internal" href="#contact-file-format" id="id26">Contact File Format</a></li>
<li><a class="reference internal" href="#contact-file-location" id="id27">Contact File Location</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8" id="id28">Communication Gateway</a></li>
<li><a class="reference internal" href="#network-support-monitoring" id="id29">Network Support Monitoring</a></li>
<li><a class="reference internal" href="#remote-monitoring-of-online-services" id="id30">Remote Monitoring of Online Services</a></li>
<li><a class="reference internal" href="#next-services" id="id31">Next Services</a></li>
</ul>
</li>
<li><a class="reference internal" href="#licence" id="id32">Licence</a></li>
<li><a class="reference internal" href="#current-stable-version-download" id="id33">Current Stable Version &amp; Download</a><ul>
<li><a class="reference internal" href="#using-cutting-edge-git" id="id34">Using Cutting-Edge GIT</a></li>
<li><a class="reference internal" href="#using-otp-related-build-runtime-conventions" id="id35">Using OTP-Related Build/Runtime Conventions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support" id="id36">Support</a></li>
<li><a class="reference internal" href="#please-react" id="id37">Please React!</a></li>
<li><a class="reference internal" href="#ending-word" id="id38">Ending Word</a></li>
</ul>
</div>
<p></p>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#id18">Overview</a></h1>
<p>We present here a short overview of the general automated services offered by our so-called &quot;Universal Server&quot;, to introduce them to newcomers. These services are implemented by <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main">US-Main</a>, which relies notably on <a class="reference external" href="https://github.com/Olivier-Boudeville/us-common">US-Common</a>.</p>
<p>The next level of information is to read the corresponding <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/tree/master/src">source files</a>, which are intensely commented and generally straightforward.</p>
<p>The project repository is located <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main">here</a>.</p>
</div>
<div class="section" id="layer-stack">
<h1><a class="toc-backref" href="#id19">Layer Stack</a></h1>
<p>From the highest level to the lowest, as summarised <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main">here</a>, a software stack involving the Universal Server usually is like:</p>
<ul class="simple">
<li>the <em>Universal Server</em> services themselves (i.e. this <a class="reference external" href="http://us.esperide.org/">us-main</a> layer)</li>
<li>[optional] the <em>Universal Webserver</em>, i.e. <a class="reference external" href="http://us-web.esperide.org/">US-Web</a> (for web interaction)</li>
<li><a class="reference external" href="http://us-common.esperide.org/">US-Common</a> (for US base facilities)</li>
<li>[optional] <a class="reference external" href="http://mobile.esperide.org">Ceylan-Mobile</a> (for 3G connectivity, notably SMS sending, relying on the Gammu library)</li>
<li>[optional] <a class="reference external" href="http://seaplus.esperide.org">Ceylan-Seaplus</a> (prerequisite of Ceylan-Mobile for a bridge from Erlang to the C language)</li>
<li><a class="reference external" href="http://traces.esperide.org">Ceylan-Traces</a> (for advanced runtime traces)</li>
<li><a class="reference external" href="http://wooper.esperide.org">Ceylan-WOOPER</a> (for OOP)</li>
<li><a class="reference external" href="http://myriad.esperide.org">Ceylan-Myriad</a> (as an Erlang toolbox)</li>
<li><a class="reference external" href="http://erlang.org">Erlang</a> (for the compiler and runtime)</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Linux">GNU/Linux</a></li>
</ul>
<p>The shorthand for <tt class="docutils literal">Universal Server</tt> is <tt class="docutils literal">us</tt>.</p>
<p></p>
</div>
<div class="section" id="configuration">
<span id="us-main-configuration-file"></span><h1><a class="toc-backref" href="#id20">Configuration</a></h1>
<p>The US-Main server is part of our &quot;Universal Server&quot; infrastructure, and as such relies on the <a class="reference external" href="https://us-common.esperide.org/#configuration">base US-Common configuration settings</a>.</p>
<p>So the base information of the user-specified <tt class="docutils literal">us.config</tt> file, found in the US Configuration directory, will apply (see <a class="reference external" href="https://github.com/Olivier-Boudeville/us-common/blob/master/priv/for-testing/us.config">this example thereof</a>).</p>
<p>Notably, in this file, a <tt class="docutils literal">us_main_config_filename</tt> entry can be specified in order to designate the US-Main configuration file that shall be used; for example:</p>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="n">us_main_config_filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;us-main-for-tests.config&quot;</span><span class="p">}.</span>
</pre>
<p>This US-Main configuration file concentrates the settings of all the services presented below, and the ones of US-Main itself; it is additionally used by the <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/tree/master/priv/bin">US-Main scripts</a>, notably in order to start, stop, or monitor a designated US-Main server.</p>
</div>
<div class="section" id="facilities-provided-by-this-us-main-layer">
<h1><a class="toc-backref" href="#id21">Facilities Provided by this US-Main Layer</a></h1>
<p>These are mainly per-host administration services.</p>
<div class="section" id="monitoring-of-host-sensors">
<h2><a class="toc-backref" href="#id22">Monitoring of Host Sensors</a></h2>
<p>The objective here is to track the various (and numerous) sensors of interest that most modern computers include; should abnormal feedback be detected, it is to be automatically reported thanks to the <a class="reference internal" href="#communication-gateway">communication gateway</a> service.</p>
<p>The <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/blob/master/src/class_USSensorManager.erl">US Sensor Manager</a> tracks automatically many <strong>hardware sensors</strong>; at start-up it detects the main available ones, regarding:</p>
<ul class="simple">
<li><strong>temperatures</strong> at various locations: the CPU socket, the CPU package and cores themselves, any APU, the motherboard, the chipset, ACPI, some disks (ex: NVME); in the future, adding GPU and RAM modules is considered</li>
<li>the <strong>speed of the fans</strong> known of the motherboard (as opposed to any case fan that would be directly connected to the power supply and that would remain invisible)</li>
<li><strong>chassis intrusion</strong>, should such sensors be available</li>
</ul>
<p>(other sensors like batteries, network or USB interfaces, etc. are at least currently ignored, as their measurements are mostly voltage levels)</p>
<p>From then, the sensor manager periodically monitors the various measurement points exhibited by such sensors: it does its best to filter bogus values, to detect abnormal changes and to report to the user any related issue.</p>
<div class="section" id="preparing-the-setup">
<h3><a class="toc-backref" href="#id23">Preparing the Setup</a></h3>
<p>The monitoring done by this server relies on the <tt class="docutils literal">sensors</tt> executable
(typically <tt class="docutils literal">/usr/bin/sensors</tt>, obtained generally from a package of the same
name and relying on <a class="reference external" href="https://github.com/lm-sensors/lm-sensors">lm-sensors</a>). One may install the <tt class="docutils literal"><span class="pre">i2c-tools</span></tt>
package as well for DIMM information (see R2 below).</p>
<p>The <tt class="docutils literal"><span class="pre">sensors-detect</span></tt> script must have been run once by root beforehand (select then only the default, safer options, by hitting Enter repeatedly or simply use its <tt class="docutils literal"><span class="pre">--auto</span></tt> option), in order to configure sensors.</p>
<p>Sensor configuration is typically stored in <tt class="docutils literal">/etc/sensors3.conf</tt>, and must exist prior to running the US-Main server.</p>
</div>
<div class="section" id="mode-of-operation-of-the-sensor-manager">
<h3><a class="toc-backref" href="#id24">Mode of Operation of the Sensor Manager</a></h3>
<p>Once the sensor manager is started, <strong>temperatures</strong> are periodically tracked (i.e. the currently reported one, plus minimum, maximum, and average since start) and compared to thresholds (any critical temperature as reported by the chips, and also ones set by our sensor manager itself in order to trigger alarms).</p>
<p>Abnormal temperatures (that is, going above - or even below - relevant thresholds) are then automatically timestamped and reported to the user by the US logic (i.e. notified in traces with appropriate severity, and possibly sent to the user thanks to emails and/or SMS, see the <a class="reference internal" href="#communication-gateway">communication gateway</a> service).</p>
<p>Similarly, any <strong>fan</strong> that would stop whereas not being PWM <a class="footnote-reference" href="#id6" id="id5">[1]</a>  is reported, and the same applies should an <strong>intrusion</strong> happen.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[1]</a></td><td>PWM stands for <a class="reference external" href="https://en.wikipedia.org/wiki/Pulse-width_modulation">Pulse-width modulation</a>; the speed of these fans can be controlled by their power source (typically the motherboard).</td></tr>
</tbody>
</table>
<p>Many sensors report bogus values; the US Sensor Manager does its best to filter them out appropriately. This includes temperatures outside of any realistic ranges and an intrusion being reported right from US-Main startup (whereas, supposedly, it had not happened already).</p>
<div class="section" id="temperature-monitoring">
<h4>Temperature monitoring</h4>
<p>Temperatures are monitored based on all the sensors that are supported by <tt class="docutils literal"><span class="pre">lm-sensors</span></tt> (notably the motherboard and CPU ones). Many sensors report, even when they are correctly tuned, bogus values, and are more like very poor random generators (see how to <a class="reference internal" href="#mute">mute</a> them).</p>
<p>The sensor manager considers that, when it starts, most temperatures are under control. So it will consider that any too low or too high temperature reported is bogus (refer to the <tt class="docutils literal">{low,high}_bogus_temperature_threshold</tt> defines).</p>
<p>In the future, extra information sources could be used:</p>
<ul class="simple">
<li>Hard Disk Drives, thanks to hddtemp, libatasmart, udisks2 or smartmontools</li>
<li>DIMM Temperature sensors (see R2)</li>
<li>GPU, thanks to XNVCtrl for NVidia ones, or ADL SDK for ATI ones</li>
</ul>
<p>Refer to R5 for further details.</p>
<p>Note that <a class="reference external" href="https://en.wikipedia.org/wiki/Platform_Controller_Hub">Platform Controller Hub</a> (ex: <tt class="docutils literal"><span class="pre">pch_cannonlake-virtual-*</span></tt>, <tt class="docutils literal"><span class="pre">pch_skylake-virtual-*</span></tt>, etc. ) are Intel's single-chip chipsets; they tend to run hotter than CPUs.</p>
<p>They may be reported as autonomous first-level entries, or as measurement points of the motherboard.</p>
</div>
<div class="section" id="fan-control">
<h4>Fan Control</h4>
<p>The rotation speed of the fans can be measured thanks to <tt class="docutils literal"><span class="pre">lm-sensors</span></tt> as well.</p>
<p>Note that not all fans are known of the motherboard, notably the ones that are directly controlled by the user through a button (ex: stop/low/high) will remain invisible to all programs.</p>
<p>Currently the sensor manager is not able to discriminate between fixed-speed fans and PWM ones.</p>
<p>The <tt class="docutils literal">pulses</tt> attribute (ex: <tt class="docutils literal">fan2_pulses</tt>) tells how many of such pulses are generated per revolution of the fan.</p>
</div>
<div class="section" id="chassis-intrusion">
<h4>Chassis Intrusion</h4>
<p>In this last case, prior to launching the US server, one may try to reset them; for example, as root:</p>
<pre class="code bash literal-block">
$ ls -l /sys/class/hwmon/hwmon*/intrusion*
-rw-r--r-- <span class="m">1</span> root root <span class="m">4096</span> Jul <span class="m">11</span> <span class="m">19</span>:30 /sys/class/hwmon/hwmon3/intrusion0_alarm
-rw-r--r-- <span class="m">1</span> root root <span class="m">4096</span> Jul  <span class="m">8</span> <span class="m">21</span>:46 /sys/class/hwmon/hwmon3/intrusion0_beep
-rw-r--r-- <span class="m">1</span> root root <span class="m">4096</span> Jul <span class="m">11</span> <span class="m">19</span>:30 /sys/class/hwmon/hwmon3/intrusion1_alarm
-rw-r--r-- <span class="m">1</span> root root <span class="m">4096</span> Jul  <span class="m">8</span> <span class="m">21</span>:46 /sys/class/hwmon/hwmon3/intrusion1_beep
$ <span class="nb">echo</span> <span class="m">0</span> &gt;<span class="p">|</span> /sys/class/hwmon/hwmon3/intrusion1_alarm
$ cat /sys/class/hwmon/hwmon3/intrusion1_alarm
<span class="m">1</span>
</pre>
<p>As shown, this may not succeed.</p>
</div>
<div class="section" id="muting-faulty-sensors">
<span id="mute"></span><h4>Muting Faulty Sensors</h4>
<p>Some sensors are hopelessly flawed and are bound to raise false alarms at any time.</p>
<p>Once they triggered a sufficient number of them, the safest route is to mute them, which can be done thanks to the <tt class="docutils literal">us_sensor_monitoring</tt> entry of the <a class="reference internal" href="#us-main-configuration-file">US-Main configuration file</a>.</p>
<p>Let's suppose that a sensor whose identifier is <tt class="docutils literal">{_SensorType=nct6792, _SensorInterface=isa, <span class="pre">_SensorNumber=&quot;0a20&quot;}</span></tt> shall have its measurement point <tt class="docutils literal">AUXTIN1</tt> be muted, and that one wants to disable another one, <tt class="docutils literal">{acpitz, acpi, &quot;0&quot;}</tt>, as a whole (i.e. all its measurement points).</p>
<p>It can be done with the following configuration entry:</p>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="n">sensor_monitoring</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w">

   </span><span class="c">% Here shall be specified a list of</span><span class="w">
   </span><span class="c">% {sensor_id(), 'all_points' | [ measurement_point_name() ]} pairs</span><span class="w">
   </span><span class="c">% in order to mute bogus sensors / measurement points:</span><span class="w">
   </span><span class="c">%</span><span class="w">
   </span><span class="p">{</span><span class="n">muted_measurement_points</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="p">{{</span><span class="n">nct6792</span><span class="p">,</span><span class="w"> </span><span class="n">isa</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0a20&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;AUXTIN1&quot;</span><span class="p">]},</span><span class="w">
       </span><span class="p">{{</span><span class="n">acpitz</span><span class="p">,</span><span class="w"> </span><span class="n">acpi</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">all_points</span><span class="p">}</span><span class="w">
                              </span><span class="p">]}</span><span class="w">
                       </span><span class="p">]}.</span>
</pre>
</div>
<div class="section" id="other-related-technical-information">
<h4>Other Related Technical Information</h4>
<p>To access information regarding a given sensor, <tt class="docutils literal">psensor</tt> may be used: open the preferences of the sensor (click on its name in the main window), and select the menu item <em>Preferences</em>, and look at the <em>Chip</em> field. See <a class="reference external" href="https://wpitchoune.net/psensor/faq.html">this link</a> for more information.</p>
<p>The <tt class="docutils literal">sensors</tt> tool is reporting values found in the Linux virtual file system directory, in <tt class="docutils literal"><span class="pre">/sys/class/thermal/thermal_zone*/{temp,type}</span></tt> for temperatures.</p>
<p>Examples:</p>
<ul class="simple">
<li><tt class="docutils literal">Package id 0</tt> is your (first) CPU</li>
<li><tt class="docutils literal"><span class="pre">dell_smm-virtual-0</span></tt> is your CPU fan, managed by your system firmware</li>
<li><tt class="docutils literal"><span class="pre">acpitz-virtual-0</span></tt> (<em>ACPI Thermal Zone</em>) is the temperature sensor near/on your CPU socket; this sensor can be unreliable</li>
<li><tt class="docutils literal"><span class="pre">coretemp-isa-0000</span></tt> measures the temperature of the specific cores</li>
</ul>
<p>See the many comments in <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/blob/master/src/class_USSensorManager.erl">class_USSensorManager.erl</a> for more details.</p>
<p>See also the following resources:</p>
<ul class="simple">
<li><a class="reference external" href="https://askubuntu.com/questions/843231/what-is-the-meaning-of-the-output-of-the-command-sensors">R1</a>: interpreting the output of <tt class="docutils literal">sensors</tt></li>
<li><a class="reference external" href="https://wiki.archlinux.org/title/lm_sensors">R2</a>: the <tt class="docutils literal">lm_sensors</tt> documentation of Arch Linux</li>
<li><a class="reference external" href="https://www.linux.com/topic/desktop/advanced-lm-sensors-tips-and-tricks-linux-0/">R3</a> and <a class="reference external" href="https://www.linux.com/training-tutorials/jazz-lm-sensors-graphics-and-notifications-0/">R4</a>: <tt class="docutils literal"><span class="pre">lm-sensors</span></tt> tips and tricks</li>
<li><a class="reference external" href="https://wpitchoune.net/psensor/">R5</a>: information about <tt class="docutils literal">psensor</tt></li>
<li><a class="reference external" href="https://blog.hqcodeshop.fi/archives/276-Improving-Nuvoton-NCT6776-lm_sensors-output.html">R6</a>: an example of preparation/tuning of one's sensors</li>
</ul>
</div>
</div>
</div>
<div class="section" id="id7">
<span id="contact-directory"></span><h2><a class="toc-backref" href="#id25">Contact Directory</a></h2>
<p>The US Contact Directory server allows US-Main to track information regarding US contacts, for various purposes, including for the US <a class="reference internal" href="#communication-gateway">communication gateway</a>.</p>
<div class="section" id="contact-file-format">
<h3><a class="toc-backref" href="#id26">Contact File Format</a></h3>
<p>Contact files are <a class="reference external" href="https://myriad.esperide.org/#etf">ETF files</a> that contain a range of information about persons and organisations of interest.</p>
<p>Each non-commented line of these files shall be of the following format:</p>
<pre class="code erlang literal-block">
<span class="p">-</span><span class="ni">type</span><span class="w"> </span><span class="n">contact_line</span><span class="p">()</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">UserId</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">user_id</span><span class="p">(),</span><span class="w">
   </span><span class="nv">FirstName</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ustring</span><span class="p">(),</span><span class="w"> </span><span class="nv">LastName</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ustring</span><span class="p">(),</span><span class="w"> </span><span class="nv">NickName</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ustring</span><span class="p">(),</span><span class="w">
   </span><span class="nv">Comment</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ustring</span><span class="p">(),</span><span class="w"> </span><span class="nv">BirthDate</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w">
   </span><span class="nv">LandlineNumber</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="nv">MobileNumber</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w">
   </span><span class="nv">PrimaryEmailAddress</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w">
   </span><span class="nv">SecondaryEmailAddress</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w">
   </span><span class="nv">PostalAddress</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">maybe</span><span class="p">(</span><span class="w"> </span><span class="n">ustring</span><span class="p">()</span><span class="w"> </span><span class="p">),</span><span class="w">
   </span><span class="nv">Roles</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">role</span><span class="p">()</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}.</span>
</pre>
<p>A typical contact line could then be:</p>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bond&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;007&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MI6 Agent 007&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">17</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1971</span><span class="p">},</span><span class="w">
 </span><span class="s">&quot;+44 9 81 47 25 40&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+44 6 26 83 37 22&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;james.bond&#64;mi6.uk.org&quot;</span><span class="p">,</span><span class="w">
 </span><span class="n">undefined</span><span class="p">,</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">administrator</span><span class="p">,</span><span class="w"> </span><span class="n">secret_agent</span><span class="p">]</span><span class="w"> </span><span class="p">}.</span>
</pre>
<p>See also our <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/blob/master/test/test_contact_directory.etf">test contact ETF file</a> as a full example thereof.</p>
</div>
<div class="section" id="contact-file-location">
<h3><a class="toc-backref" href="#id27">Contact File Location</a></h3>
<p>The path to a contact file can be either specified as an absolute one, or as a relative one - in which case it will be deemed relative to the US configuration directory.</p>
<p>They may be mere symlinks pointing to contact files kept in VCS in other locations.</p>
</div>
</div>
<div class="section" id="id8">
<span id="communication-gateway"></span><h2><a class="toc-backref" href="#id28">Communication Gateway</a></h2>
<p>The purpose of the US Communication Gateway is to enable (possibly two-way) exchanges with the US users.</p>
<p>Such communication is not to happen frow a web-based medium (see <a class="reference external" href="http://us-web.esperide.org">US-Web</a> for that), but through alternate modes such as SMS (relying then on <a class="reference external" href="http://mobile.esperide.org">Ceylan-Mobile</a>) and/or e-mails (relying then on <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/utils/email_utils.erl">the corresponding services of Ceylan-Myriad</a>).</p>
<p>For that, the correspondance between a US role (ex: <tt class="docutils literal">administrator</tt>) and actual user information is established thanks to the <a class="reference internal" href="#contact-directory">contact directory</a> service.</p>
</div>
<div class="section" id="network-support-monitoring">
<span id="network-infrastructure-tracker"></span><h2><a class="toc-backref" href="#id29">Network Support Monitoring</a></h2>
<p>This service allows to ensure that the local host (on which US-Main is running) enjoys a functional <strong>network support</strong>, in terms of:</p>
<ul class="simple">
<li>ICMP probes (ping)</li>
<li>Internet (IP) connectivity</li>
<li>DNS resolution</li>
</ul>
<p>This is checked by ensuring periodically that a set of target hosts, specified as direct IP addresses and/or DNS names, can indeed be interacted with through the network.</p>
<p>Of course any issue (typically outage of a given network service) is then reported by appropriate means (i.e. by SMS rather than by email then).</p>
<p>Extra</p>
</div>
<div class="section" id="remote-monitoring-of-online-services">
<span id="monitoring-of-online-services"></span><h2><a class="toc-backref" href="#id30">Remote Monitoring of Online Services</a></h2>
<p>The purpose here is to monitor online services (typically websites) provided by networked peers.</p>
<p>Each service is tracked based on a set of information:</p>
<ul class="simple">
<li>protocol: <tt class="docutils literal">http</tt>, <tt class="docutils literal">https</tt>, maybe in the future <tt class="docutils literal">ftp</tt> or alike</li>
<li>base hostname, specified as a DNS name or an IP address</li>
<li>possibly a resource designator (ex: a specific URL) for the actual checking</li>
</ul>
</div>
<div class="section" id="next-services">
<h2><a class="toc-backref" href="#id31">Next Services</a></h2>
<p>The following services are planned (some day) for addition:</p>
<ul class="simple">
<li>UPS (<a class="reference external" href="https://en.wikipedia.org/wiki/Uninterruptible_power_supply">Uninterruptible Power Supply</a>) monitoring, to be notified whenever a related event happens (typically a power failure from the electrical grid)</li>
</ul>
</div>
</div>
<div class="section" id="licence">
<span id="free-software"></span><h1><a class="toc-backref" href="#id32">Licence</a></h1>
<p>The <tt class="docutils literal">Universal Server</tt> is licensed by its author (Olivier Boudeville) under the <a class="reference external" href="https://www.gnu.org/licenses/agpl-3.0.en.html">GNU Affero General Public License</a> as published by the Free Software Foundation, either version 3 of this license, or (at your option) any later version.</p>
<p>This allows the use of the Universal Server code in a wide a variety of software projects, while still maintaining copyleft on this code, ensuring improvements are shared.</p>
<p>We hope indeed that enhancements will be back-contributed (ex: thanks to merge requests), so that everyone will be able to benefit from them.</p>
</div>
<div class="section" id="current-stable-version-download">
<h1><a class="toc-backref" href="#id33">Current Stable Version &amp; Download</a></h1>
<p>As mentioned, the single mandatory prerequisite of the <a class="reference external" href="https://github.com/Olivier-Boudeville/UniversalServer">Universal Server</a> is <a class="reference external" href="http://us-common.esperide.org/">US-Common</a>, which relies on <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Traces">Ceylan-Traces</a>, which implies in turn <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-WOOPER">Ceylan-WOOPER</a>, then <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">Ceylan-Myriad</a> and <a class="reference external" href="http://erlang.org">Erlang</a>.</p>
<p>We prefer using GNU/Linux, sticking to the latest stable release of Erlang (refer to the corresponding <a class="reference external" href="http://myriad.esperide.org#prerequisites">Myriad prerequisite section</a>  for more precise guidelines), and building the Universal Server from sources, thanks to GNU <tt class="docutils literal">make</tt>.</p>
<p>We recommend, for all Erlang-related software, to rely on rebar3.</p>
<p>One wanting to be able to operate on the source code of these dependencies may define appropriate symbolic links in a <tt class="docutils literal">_checkouts</tt> directory created at the root of <tt class="docutils literal"><span class="pre">us-main</span></tt>, these links pointing to relevant GIT clones.</p>
<div class="section" id="using-cutting-edge-git">
<h2><a class="toc-backref" href="#id34">Using Cutting-Edge GIT</a></h2>
<p>This is the installation method that we use and recommend; the Universal Server <tt class="docutils literal">master</tt> branch is meant to stick to the latest stable version: we try to ensure that this main line always stays functional (sorry for the pun). Evolutions are to take place in feature branches and to be merged only when ready.</p>
<p>Once Erlang, Cowboy and possibly Awstats are available, it should be just a matter of executing:</p>
<pre class="code bash literal-block">
$ git clone https://github.com/Olivier-Boudeville/Ceylan-Myriad myriad
$ <span class="nb">cd</span> myriad <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..

$ git clone https://github.com/Olivier-Boudeville/Ceylan-WOOPER wooper
$ <span class="nb">cd</span> wooper <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..

$ git clone https://github.com/Olivier-Boudeville/Ceylan-Traces traces
$ <span class="nb">cd</span> traces <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..

<span class="c1"># Possibly:
</span>$ git clone https://github.com/Olivier-Boudeville/Ceylan-Seaplus seaplus
$ <span class="nb">cd</span> seaplus <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..

$ git clone https://github.com/Olivier-Boudeville/Ceylan-Mobile mobile
$ <span class="nb">cd</span> mobile <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ..


$ git clone https://github.com/Olivier-Boudeville/us-common
$ <span class="nb">cd</span> us-common <span class="o">&amp;&amp;</span> make all

$ git clone https://github.com/Olivier-Boudeville/us-main
$ <span class="nb">cd</span> us-main <span class="o">&amp;&amp;</span> make all
</pre>
<p><span class="raw-html"><a name="otp"></a></span></p>
</div>
<div class="section" id="using-otp-related-build-runtime-conventions">
<span id="otp-build"></span><h2><a class="toc-backref" href="#id35">Using OTP-Related Build/Runtime Conventions</a></h2>
<p>As discussed in these sections of <a class="reference external" href="http://myriad.esperide.org/myriad.html#otp">Myriad</a>, <a class="reference external" href="http://wooper.esperide.org/index.html#otp">WOOPER</a>, <a class="reference external" href="http://traces.esperide.org/index.html#otp">Traces</a> and <a class="reference external" href="http://us-common.esperide.org/index.html#otp">US-Common</a>, we added the (optional) possibility of generating a Universal Server <em>OTP application</em> out of the build tree, ready to result directly in an <em>(OTP) release</em>. For that we rely on <a class="reference external" href="https://www.rebar3.org/">rebar3</a>, <a class="reference external" href="https://github.com/erlware/relx">relx</a> and <a class="reference external" href="https://hex.pm/">hex</a>.</p>
<p>Then we benefit from a standalone, complete Universal Server.</p>
<p>As for Myriad, WOOPER, Traces and US-Common, most versions of the Universal Server are also published as <a class="reference external" href="https://hex.pm/packages/us_main">Hex packages</a>.</p>
<p>For more details, one may have a look at:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/blob/master/conf/rebar.config.template">rebar.config.template</a>, the general rebar configuration file used when generating the Universal Server OTP application and release (implying the automatic management of Myriad and WOOPER)</li>
<li><a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/blob/master/conf/rebar-for-hex.config.template">rebar-for-hex.config.template</a>, to generate a corresponding Hex package for Universal Server (whose structure and conventions is quite different from the previous OTP elements)</li>
</ul>
</div>
</div>
<div class="section" id="support">
<h1><a class="toc-backref" href="#id36">Support</a></h1>
<p>Bugs, questions, remarks, patches, requests for enhancements, etc. are to be reported to the <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main">project interface</a> (typically <a class="reference external" href="https://github.com/Olivier-Boudeville/us-main/issues">issues</a>) or directly at the email address mentioned at the beginning of this document.</p>
</div>
<div class="section" id="please-react">
<h1><a class="toc-backref" href="#id37">Please React!</a></h1>
<p>If you have information more detailed or more recent than those presented in this document, if you noticed errors, neglects or points insufficiently discussed, drop us a line! (for that, follow the <a class="reference internal" href="#support">Support</a> guidelines).</p>
</div>
<div class="section" id="ending-word">
<h1><a class="toc-backref" href="#id38">Ending Word</a></h1>
<p>Have fun with the Universal Server!</p>
<p><span class="raw-html"><center><img src="us-main-title.png" id="responsive-image-small"></img></center></span>
</p>
<p><span class="raw-html"><a name="universal-server_bottom"></a></span></p>
</div>
</div>
</body>
</html>
